<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct { color: black; }
        .error { color: red; }
        .cursor { background-color: yellow; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl">
        <h1 class="text-2xl font-bold text-center mb-4">Typing Practice</h1>
        <div class="mb-4">
            <label for="timeLimit" class="block text-sm font-medium text-gray-700">Set Time Limit (minutes):</label>
            <input type="number" id="timeLimit" class="w-24 p-2 border rounded" value="1" min="1" max="5" step="0.5">
        </div>
        <div id="sampleText" class="text-lg mb-4 p-4 bg-gray-200 rounded" contenteditable="true"></div>
        <div class="flex justify-end mb-4">
            <button id="resetBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Reset</button>
        </div>
        <div id="results" class="text-center">
            <p>WPM: <span id="wpm">0</span></p>
            <p>Accuracy: <span id="accuracy">0%</span></p>
            <p>Time Remaining: <span id="time">0m 0s</span></p>
        </div>
    </div>

    <script>
        const sampleTextElement = document.getElementById('sampleText');
        const resetBtn = document.getElementById('resetBtn');
        const wpmElement = document.getElementById('wpm');
        const accuracyElement = document.getElementById('accuracy');
        const timeElement = document.getElementById('time');
        const timeLimitInput = document.getElementById('timeLimit');

        // Lorem Ipsum generator
        const loremIpsumWords = [
            "lorem", "ipsum", "dolor", "sit", "amet", "consectetur", "adipiscing", "elit", "sed", "do",
            "eiusmod", "tempor", "incididunt", "ut", "labore", "et", "dolore", "magna", "aliqua", "ut",
            "enim", "ad", "minim", "veniam", "quis", "nostrud", "exercitation", "ullamco", "laboris",
            "nisi", "ut", "aliquip", "ex", "ea", "commodo", "consequat", "duis", "aute", "irure",
            "dolor", "in", "reprehenderit", "in", "voluptate", "velit", "esse", "cillum", "dolore",
            "eu", "fugiat", "nulla", "pariatur"
        ];

        let defaultText = "Lorem ipsum dolor sit amet, consectetur adipiscing elit.";
        let currentText = defaultText;
        let typedChars = [];
        let startTime, timerInterval;
        let isTyping = false;
        let timeLimit = 60; // Default time limit in seconds (1 minute)
        let currentPosition = 0;

        function generateLoremIpsum() {
            let words = [];
            const wordCount = Math.floor(Math.random() * 20) + 30; // 30-50 words
            for (let i = 0; i < wordCount; i++) {
                words.push(loremIpsumWords[Math.floor(Math.random() * loremIpsumWords.length)]);
            }
            return words.join(" ") + ".";
        }

        function renderText() {
            sampleTextElement.innerHTML = '';
            currentText.split('').forEach((char, index) => {
                const span = document.createElement('span');
                span.textContent = char;
                if (index < currentPosition) {
                    span.className = typedChars[index] === char ? 'correct' : 'error';
                }
                if (index === currentPosition) {
                    span.className = 'cursor';
                }
                sampleTextElement.appendChild(span);
            });
            sampleTextElement.focus();
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}m ${remainingSeconds}s`;
        }

        function startTyping() {
            if (!isTyping) {
                timeLimit = parseFloat(timeLimitInput.value) * 60 || 60; // Convert minutes to seconds
                currentText = defaultText;
                currentPosition = 0;
                typedChars = [];
                renderText();
                sampleTextElement.disabled = false;
                sampleTextElement.focus();
                startTime = new Date();
                isTyping = true;
                timeLimitInput.disabled = true;
                timeElement.textContent = formatTime(timeLimit);
                timerInterval = setInterval(updateTime, 1000);
            }
        }

        function resetTyping() {
            clearInterval(timerInterval);
            isTyping = false;
            currentText = defaultText;
            currentPosition = 0;
            typedChars = [];
            renderText();
            sampleTextElement.disabled = false;
            timeLimitInput.disabled = false;
            wpmElement.textContent = '0';
            accuracyElement.textContent = '0%';
            timeElement.textContent = formatTime(parseFloat(timeLimitInput.value) * 60 || 60);
        }

        function updateTime() {
            const currentTime = new Date();
            const timeElapsed = Math.floor((currentTime - startTime) / 1000);
            const timeRemaining = Math.max(timeLimit - timeElapsed, 0);
            timeElement.textContent = formatTime(timeRemaining);

            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                isTyping = false;
                sampleTextElement.disabled = true;
                timeLimitInput.disabled = false;
                calculateResults(); // Final calculation
            }
        }

        function calculateResults() {
            const timeElapsed = Math.min(Math.floor((new Date() - startTime) / 1000), timeLimit);
            const typedText = typedChars.join('');

            // Calculate WPM
            const wordsTyped = typedText.trim().split(' ').length;
            const wpm = timeElapsed > 0 ? Math.round((wordsTyped / timeElapsed) * 60) : 0;
            wpmElement.textContent = wpm;

            // Calculate Accuracy
            let correctChars = 0;
            for (let i = 0; i < Math.min(typedText.length, currentText.length); i++) {
                if (typedText[i] === currentText[i]) correctChars++;
            }
            const accuracy = typedText.length > 0 ? Math.round((correctChars / currentText.length) * 100) : 0;
            accuracyElement.textContent = `${accuracy}%`;
        }

        sampleTextElement.addEventListener('keydown', (e) => {
            e.preventDefault(); // Prevent default typing in contenteditable
            if (!isTyping) {
                startTyping();
            }

            if (isTyping) {
                if (e.key.length === 1) { // Regular character
                    typedChars[currentPosition] = e.key;
                    currentPosition++;
                    calculateResults();
                    if (currentPosition >= currentText.length) {
                        currentText = generateLoremIpsum();
                        currentPosition = 0;
                        typedChars = [];
                    }
                    renderText();
                } else if (e.key === 'Backspace' && currentPosition > 0) {
                    currentPosition--;
                    typedChars.pop();
                    calculateResults();
                    renderText();
                }
            }
        });

        resetBtn.addEventListener('click', resetTyping);
        timeLimitInput.addEventListener('change', () => {
            if (!isTyping) {
                timeElement.textContent = formatTime(parseFloat(timeLimitInput.value) * 60 || 60);
            }
        });

        // Initialize
        resetTyping();
    </script>
</body>
</html>
